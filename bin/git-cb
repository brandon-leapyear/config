#!/usr/bin/env zsh

set -eu -o pipefail

usage="
Usage: git cb BRANCH [BASE]

Create a new 'chinn/*' branch.

Parameters:
BRANCH              The name of the branch to create
BASE                The base of the branch (defaults to master)
"

function abort { print "$@" >&2; exit 1 }
function abort_help { abort -f '%s\n' "$@" $usage }

function git_cb {
    if [[ -n "$(git ls-files -m --exclude-standard)" ]]; then
        abort "There are modified files"
    fi

    local branch=${1:-}
    local base=${2:-master}

    if [[ -z $branch ]]; then
        abort_help
    fi

    git checkout -b "chinn/${branch}"
    print "Resetting to ${base}"
    git reset --hard "${base}" &> /dev/null
}

git_cb "$@"
